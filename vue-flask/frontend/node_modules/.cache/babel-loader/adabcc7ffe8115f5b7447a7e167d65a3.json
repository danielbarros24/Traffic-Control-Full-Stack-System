{"ast":null,"code":"import _asyncToGenerator from \"/home/daniel/Projects/Thesis/Jamadgy/python_backend/vue-flask/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/web.url.to-json.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.json.stringify.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ReteEditor from \"@/components/rete/ReteEditor\";\nexport default {\n  name: \"Automations\",\n  components: {\n    ReteEditor: ReteEditor\n  },\n  data: function data() {\n    var gpios = [];\n\n    for (var i = 1; i < 27; i++) {\n      gpios.push({\n        text: \"GPIO \".concat(i),\n        value: i\n      });\n    }\n\n    return {\n      gpios: gpios,\n      gpiosValues: [],\n      value: null,\n      items: [{\n        title: \"Logout\",\n        icon: \"mdi-logout\",\n        click: function click() {\n          console.log(\"logout\");\n          this.$router.push(\"/\");\n        }\n      }, {\n        title: \"Dashboard\",\n        icon: \"mdi-view-dashboard\",\n        click: function click() {\n          console.log(\"dashboard\");\n          this.$router.push(\"dashboard\");\n        }\n      }, {\n        title: \"Settings\",\n        icon: \"mdi-cogs\",\n        click: function click() {\n          console.log(\"settings\");\n          this.$router.push(\"settings\");\n        }\n      }],\n      dates: [],\n      time1: null,\n      time2: null,\n      menuStart: false,\n      menuEnd: false,\n      menu1: null,\n      menu2: null,\n      switch1: false,\n      AutomationName: \"\",\n      dialog: false,\n      rule_dialog: false,\n      dialogDelete: false,\n      headers: [{\n        text: \"\",\n        value: \"state\",\n        sortable: false,\n        width: 0\n      }, {\n        text: \"Name\",\n        align: \"start\",\n        value: \"name\"\n      }, {\n        text: \"Actions\",\n        value: \"actions\",\n        sortable: false\n      }],\n      automations: [],\n      editedIndex: -1,\n      editedItem: {\n        name: \"\",\n        rule: 0,\n        gpios: [],\n        state: false\n      },\n      defaultItem: {\n        name: \"\",\n        rule: 0,\n        gpios: [],\n        state: false\n      },\n      editor: null,\n      editorJSON: \"\"\n    };\n  },\n  computed: {\n    formTitle: function formTitle() {\n      return this.editedIndex === -1 ? \"New Automation\" : \"Edit Automation\";\n    },\n    dateRangeText: function dateRangeText() {\n      return this.dates.join(\" ~ \");\n    }\n  },\n  watch: {\n    dialog: function dialog(val) {\n      val || this.close();\n    },\n    dialogDelete: function dialogDelete(val) {\n      val || this.closeDelete();\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.initialize();\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    createNodeClick: function createNodeClick() {\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    handleClick: function handleClick(index) {\n      this.items[index].click.call(this);\n    },\n    clickLogo: function clickLogo() {\n      this.$router.push(\"dashboard\");\n    },\n    initialize: function initialize() {\n      this.automations = [{\n        name: \"Automation 1\",\n        state: false,\n        gpios: [],\n        blueprint: {\n          id: \"demo@0.1.0\",\n          nodes: {\n            4: {\n              id: 4,\n              data: {},\n              inputs: {\n                num1: {\n                  connections: [{\n                    node: 5,\n                    output: \"num\",\n                    data: {}\n                  }, {\n                    node: 6,\n                    output: \"num\",\n                    data: {}\n                  }]\n                }\n              },\n              outputs: {\n                num: {\n                  connections: [{\n                    node: 9,\n                    input: \"num1\",\n                    data: {}\n                  }]\n                }\n              },\n              position: [204.8333740234375, -356.75],\n              name: \"+\"\n            },\n            5: {\n              id: 5,\n              data: {\n                num1: \"25\"\n              },\n              inputs: {},\n              outputs: {\n                num: {\n                  connections: [{\n                    node: 4,\n                    input: \"num1\",\n                    data: {}\n                  }, {\n                    node: 9,\n                    input: \"num2\",\n                    data: {}\n                  }]\n                }\n              },\n              position: [-179.1666259765625, -156.75],\n              name: \"Constant\"\n            },\n            6: {\n              id: 6,\n              data: {\n                type: \"ALL\"\n              },\n              inputs: {},\n              outputs: {\n                num: {\n                  connections: [{\n                    node: 4,\n                    input: \"num1\",\n                    data: {}\n                  }]\n                }\n              },\n              position: [-632.1666259765625, -397.75],\n              name: \"Tempo de permanência\"\n            },\n            9: {\n              id: 9,\n              data: {},\n              inputs: {\n                num1: {\n                  connections: [{\n                    node: 4,\n                    output: \"num\",\n                    data: {}\n                  }]\n                },\n                num2: {\n                  connections: [{\n                    node: 5,\n                    output: \"num\",\n                    data: {}\n                  }]\n                }\n              },\n              outputs: {\n                num: {\n                  connections: [{\n                    node: 10,\n                    input: \"num\",\n                    data: {}\n                  }]\n                }\n              },\n              position: [575.0035706388225, -319.57509650521735],\n              name: \"A>B\"\n            },\n            10: {\n              id: 10,\n              data: {},\n              inputs: {\n                num: {\n                  connections: [{\n                    node: 9,\n                    output: \"num\",\n                    data: {}\n                  }]\n                }\n              },\n              outputs: {},\n              position: [951.6885958661557, -262.21828330473755],\n              name: \"End\"\n            }\n          }\n        }\n      }];\n    },\n    editItem: function editItem(item) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _this2.editedIndex = _this2.automations.indexOf(item);\n                _this2.editedItem = Object.assign({}, item);\n                _this2.dialog = true;\n                setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n                  var blueprint;\n                  return regeneratorRuntime.wrap(function _callee3$(_context3) {\n                    while (1) {\n                      switch (_context3.prev = _context3.next) {\n                        case 0:\n                          blueprint = _this2.editedItem.blueprint; // import blueprint\n\n                          _context3.next = 3;\n                          return _this2.editor.fromJSON(blueprint);\n\n                        case 3:\n                        case \"end\":\n                          return _context3.stop();\n                      }\n                    }\n                  }, _callee3);\n                })), 200);\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    },\n    deleteItem: function deleteItem(item) {\n      this.editedIndex = this.automations.indexOf(item);\n      this.editedItem = Object.assign({}, item);\n      this.dialogDelete = true;\n    },\n    deleteItemConfirm: function deleteItemConfirm() {\n      this.automations.splice(this.editedIndex, 1);\n      this.closeDelete();\n    },\n    close: function close() {\n      var _this3 = this;\n\n      this.dialog = false;\n      this.$nextTick(function () {\n        _this3.editedItem = Object.assign({}, _this3.defaultItem);\n        _this3.editedIndex = -1;\n      });\n    },\n    closeDelete: function closeDelete() {\n      var _this4 = this;\n\n      this.dialogDelete = false;\n      this.$nextTick(function () {\n        _this4.editedItem = Object.assign({}, _this4.defaultItem);\n        _this4.editedIndex = -1;\n      });\n    },\n    save: function save() {\n      var _this5 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5() {\n        var _endComponent$toJsonL;\n\n        var editor, blueprint, endNode, endComponent, logic, startTime, endTime, automation, file;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                editor = _this5.editor;\n                _context5.next = 3;\n                return editor.toJSON();\n\n              case 3:\n                blueprint = _context5.sent;\n                endNode = _this5.editor.nodes.find(function (node) {\n                  return node.name === \"End\";\n                });\n                endComponent = editor.getComponent(\"End\");\n                logic = (_endComponent$toJsonL = endComponent.toJsonLogic) === null || _endComponent$toJsonL === void 0 ? void 0 : _endComponent$toJsonL.call(endComponent, endNode);\n                startTime = _this5.dates;\n                endTime = _this5.dates;\n                automation = {\n                  name: _this5.editedItem.name,\n                  startTime: startTime.toISOString(),\n                  endTime: endTime.toISOString(),\n                  enable: _this5.editedItem.state,\n                  gpios: _this5.editedItem.gpios,\n                  rules: logic,\n                  blueprint: blueprint\n                };\n                file = JSON.stringify(automation);\n                console.log(file); // Enviar POST\n                // OK -> Fechar o dialog, atualizar a tabela\n\n                if (_this5.editedIndex > -1) {\n                  Object.assign(_this5.automations[_this5.editedIndex], _this5.editedItem);\n                } else {\n                  _this5.automations.push(_this5.editedItem);\n                }\n\n                _this5.close();\n\n              case 14:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }))();\n    },\n    onExport: function onExport() {\n      var _this6 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {\n        var _endComponent$toJsonL2;\n\n        var editor, endNode, endComponent;\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                editor = _this6.editor;\n                endNode = _this6.editor.nodes.find(function (node) {\n                  return node.name === \"End\";\n                });\n                endComponent = editor.getComponent(\"End\");\n                console.log(JSON.stringify((_endComponent$toJsonL2 = endComponent.toJsonLogic) === null || _endComponent$toJsonL2 === void 0 ? void 0 : _endComponent$toJsonL2.call(endComponent, endNode)));\n\n              case 4:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }))();\n    },\n    onEditorImport: function onEditorImport() {\n      var _this7 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {\n        return regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return _this7.editor.fromJSON(JSON.parse(_this7.editorJSON));\n\n              case 2:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7);\n      }))();\n    },\n    onEditorSync: function onEditorSync() {\n      var _this8 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8() {\n        return regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.t0 = JSON;\n                _context8.next = 3;\n                return _this8.editor.toJSON();\n\n              case 3:\n                _context8.t1 = _context8.sent;\n                _this8.editorJSON = _context8.t0.stringify.call(_context8.t0, _context8.t1);\n\n              case 5:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["name","components","ReteEditor","data","gpios","text","value","gpiosValues","items","title","icon","click","console","dates","time1","time2","menuStart","menuEnd","menu1","menu2","switch1","AutomationName","dialog","rule_dialog","dialogDelete","headers","sortable","width","align","automations","editedIndex","editedItem","rule","state","defaultItem","editor","editorJSON","computed","formTitle","dateRangeText","watch","val","mounted","methods","createNodeClick","handleClick","index","clickLogo","initialize","blueprint","id","nodes","inputs","num1","connections","node","output","outputs","num","input","position","type","num2","editItem","item","setTimeout","deleteItem","deleteItemConfirm","close","closeDelete","save","endNode","endComponent","logic","startTime","endTime","automation","enable","rules","file","JSON","Object","onExport","onEditorImport","onEditorSync","stringify"],"sourceRoot":"src/views","sources":["Automations.vue"],"sourcesContent":["<template>\n  <div>\n    <v-app-bar color=\"transparent\" dark elevation=\"0\">\n      <v-img\n        max-height=\"35\"\n        max-width=\"35\"\n        src=\"../assets/logo_simple.png\"\n        @click=\"clickLogo()\"\n      ></v-img>\n      <v-toolbar-title class=\"ml-4\">Automations</v-toolbar-title>\n\n      <v-spacer></v-spacer>\n\n      <v-menu transition=\"slide-y-transition\" offset-y>\n        <template v-slot:activator=\"{ on, attrs }\">\n          <v-btn icon v-bind=\"attrs\" v-on=\"on\">\n            <v-icon>mdi-account</v-icon>\n          </v-btn>\n        </template>\n\n        <v-list>\n          <v-list-item\n            v-for=\"(item, index) in items\"\n            :key=\"index\"\n            @click=\"handleClick(index)\"\n          >\n            <v-list-item-icon>\n              <v-icon v-text=\"item.icon\"></v-icon>\n            </v-list-item-icon>\n            <v-list-item-title>{{ item.title }}</v-list-item-title>\n          </v-list-item>\n        </v-list>\n      </v-menu>\n    </v-app-bar>\n\n    <v-data-table\n      :headers=\"headers\"\n      :items=\"automations\"\n      class=\"elevation-24 mt-13\"\n    >\n      <template v-slot:top>\n        <v-toolbar flat>\n          <v-toolbar-title class=\"font-weight-bold\"\n            >Automations</v-toolbar-title\n          >\n          <v-spacer></v-spacer>\n\n          <v-dialog v-model=\"dialog\" full-screen>\n            <template v-slot:activator=\"{ on, attrs }\">\n              <v-btn\n                color=\"secondary\"\n                depressed\n                elevation=\"4\"\n                raised\n                mx-auto\n                rounded\n                dark\n                v-bind=\"attrs\"\n                v-on=\"on\"\n              >\n                <v-icon class=\"mr-3\">mdi-plus</v-icon>Create automation\n              </v-btn>\n            </template>\n\n            <v-card overflow-hidden>\n              <v-card-title>\n                <span class=\"text-h4 font-weight-bold\">{{ formTitle }}</span>\n              </v-card-title>\n              <v-card-actions>\n                <v-btn color=\"blue darken-1 mr-auto\" text @click=\"save\">\n                  Save\n                </v-btn>\n                <v-btn color=\"blue darken-1 mr-auto\" text @click=\"close\">\n                  Cancel\n                </v-btn>\n              </v-card-actions>\n\n              <v-card-text>\n                <v-row>\n                  <v-col cols=\"4\" md=\"2\">\n                    <h2 class=\"mt-12\">Name</h2>\n                    <v-text-field\n                      v-model=\"editedItem.name\"\n                      label=\"Insert Automation Name Here!\"\n                      required\n                      class=\"mt-3 mb-6\"\n                    ></v-text-field>\n\n                    <div>\n                      <h2>Time</h2>\n                      <v-menu\n                        v-model=\"menu2\"\n                        :close-on-content-click=\"false\"\n                        :nudge-right=\"40\"\n                        transition=\"scale-transition\"\n                        offset-y\n                        min-width=\"auto\"\n                      >\n                        <template v-slot:activator=\"{ on, attrs }\">\n                          <v-text-field\n                            v-model=\"dateRangeText\"\n                            label=\"Select date range\"\n                            prepend-icon=\"mdi-calendar\"\n                            readonly\n                            v-bind=\"attrs\"\n                            v-on=\"on\"\n                            class=\"mt-3\"\n                          ></v-text-field>\n                        </template>\n                        <v-date-picker v-model=\"dates\" range></v-date-picker>\n                      </v-menu>\n\n                      <v-menu\n                        ref=\"menu1\"\n                        v-model=\"menuStart\"\n                        :close-on-content-click=\"false\"\n                        :nudge-right=\"40\"\n                        :return-value.sync=\"time1\"\n                        transition=\"scale-transition\"\n                        offset-y\n                        max-width=\"290px\"\n                        min-width=\"290px\"\n                      >\n                        <template v-slot:activator=\"{ on, attrs }\">\n                          <v-text-field\n                            v-model=\"time1\"\n                            label=\"Start Time\"\n                            prepend-icon=\"mdi-clock-time-four-outline\"\n                            readonly\n                            v-bind=\"attrs\"\n                            v-on=\"on\"\n                          ></v-text-field>\n                        </template>\n                        <v-time-picker\n                          v-if=\"menuStart\"\n                          v-model=\"time1\"\n                          format=\"24h\"\n                          scrollable\n                          full-width\n                          @click:minute=\"$refs.menu1.save(time1)\"\n                        ></v-time-picker>\n                      </v-menu>\n\n                      <v-menu\n                        ref=\"menu2\"\n                        v-model=\"menuEnd\"\n                        :close-on-content-click=\"false\"\n                        :nudge-right=\"40\"\n                        :return-value.sync=\"time2\"\n                        transition=\"scale-transition\"\n                        offset-y\n                        max-width=\"290px\"\n                        min-width=\"290px\"\n                      >\n                        <template v-slot:activator=\"{ on, attrs }\">\n                          <v-text-field\n                            v-model=\"time2\"\n                            label=\"End Time\"\n                            prepend-icon=\"mdi-clock-time-four-outline\"\n                            readonly\n                            v-bind=\"attrs\"\n                            v-on=\"on\"\n                            class=\"mb-6\"\n                          ></v-text-field>\n                        </template>\n                        <v-time-picker\n                          v-if=\"menuEnd\"\n                          v-model=\"time2\"\n                          format=\"24h\"\n                          scrollable\n                          full-width\n                          @click:minute=\"$refs.menu2.save(time2)\"\n                        ></v-time-picker>\n                      </v-menu>\n                    </div>\n\n                    <div>\n                      <h2>Outputs</h2>\n                      <v-row>\n                        <v-autocomplete\n                          v-model=\"editedItem.gpios\"\n                          :items=\"gpios\"\n                          chips\n                          deletable-chips\n                          multiple\n                          label=\"Select GPIOS as outputs\"\n                          class=\"ml-3 mt-3 mb-6\"\n                        >\n                          <template v-slot:item=\"{ item, on, attrs }\">\n                            <v-list-item v-on=\"on\" v-bind=\"attrs\">\n                              <v-list-item-content>\n                                <v-list-item-title>\n                                  <v-chip dark color=\"primary\">\n                                    {{ item.text }}\n                                  </v-chip>\n                                </v-list-item-title>\n                              </v-list-item-content>\n                            </v-list-item>\n                          </template>\n                        </v-autocomplete>\n                      </v-row>\n                    </div>\n\n                    <div>\n                      <h2>Enable</h2>\n                      <v-switch v-model=\"editedItem.state\"></v-switch>\n                    </div>\n\n                    <v-btn @click=\"onExport\">Export</v-btn>\n\n                    <v-textarea v-model=\"editorJSON\"></v-textarea>\n                    <v-btn @click=\"onEditorSync\">Sync</v-btn>\n                    <v-btn @click=\"onEditorImport\">Import</v-btn>\n                  </v-col>\n                  <v-col md=\"10\">\n                    <ReteEditor v-model=\"editor\" />\n                  </v-col>\n                </v-row>\n              </v-card-text>\n            </v-card>\n          </v-dialog>\n\n          <v-dialog v-model=\"dialogDelete\" max-width=\"573px\">\n            <v-card>\n              <v-card-title class=\"text-h5\"\n                >Are you sure you want to delete this automation?</v-card-title\n              >\n              <v-card-actions>\n                <v-spacer></v-spacer>\n                <v-btn color=\"blue darken-1\" text @click=\"closeDelete\"\n                  >Cancel</v-btn\n                >\n                <v-btn color=\"blue darken-1\" text @click=\"deleteItemConfirm\"\n                  >OK</v-btn\n                >\n                <v-spacer></v-spacer>\n              </v-card-actions>\n            </v-card>\n          </v-dialog>\n        </v-toolbar>\n      </template>\n      <template v-slot:[`item.state`]=\"{ item }\">\n        <v-switch\n          v-model=\"item.state\"\n          hide-details\n          class=\"ma-0 pa-0\"\n        ></v-switch>\n      </template>\n      <template v-slot:[`item.actions`]=\"{ item }\">\n        <v-icon small class=\"mr-2\" @click=\"editItem(item)\"> mdi-pencil </v-icon>\n        <v-icon small @click=\"deleteItem(item)\"> mdi-delete </v-icon>\n      </template>\n      <template v-slot:no-data>\n        <v-btn color=\"primary\" @click=\"initialize\"> Reset </v-btn>\n      </template>\n    </v-data-table>\n  </div>\n</template>\n\n<script>\nimport ReteEditor from \"@/components/rete/ReteEditor\";\n\nexport default {\n  name: \"Automations\",\n  components: {\n    ReteEditor,\n  },\n\n  data() {\n    const gpios = [];\n    for (let i = 1; i < 27; i++) {\n      gpios.push({\n        text: `GPIO ${i}`,\n        value: i,\n      });\n    }\n\n    return {\n      gpios: gpios,\n      gpiosValues: [],\n      value: null,\n\n      items: [\n        {\n          title: \"Logout\",\n          icon: \"mdi-logout\",\n          click() {\n            console.log(\"logout\");\n            this.$router.push(\"/\");\n          },\n        },\n        {\n          title: \"Dashboard\",\n          icon: \"mdi-view-dashboard\",\n          click() {\n            console.log(\"dashboard\");\n            this.$router.push(\"dashboard\");\n          },\n        },\n        {\n          title: \"Settings\",\n          icon: \"mdi-cogs\",\n          click() {\n            console.log(\"settings\");\n            this.$router.push(\"settings\");\n          },\n        },\n      ],\n\n      dates: [],\n\n      time1: null,\n      time2: null,\n      menuStart: false,\n      menuEnd: false,\n      menu1: null,\n      menu2: null,\n\n      switch1: false,\n\n      AutomationName: \"\",\n      dialog: false,\n      rule_dialog: false,\n      dialogDelete: false,\n\n      headers: [\n        {\n          text: \"\",\n          value: \"state\",\n          sortable: false,\n          width: 0,\n        },\n        {\n          text: \"Name\",\n          align: \"start\",\n          value: \"name\",\n        },\n        { text: \"Actions\", value: \"actions\", sortable: false },\n      ],\n      automations: [],\n      editedIndex: -1,\n      editedItem: {\n        name: \"\",\n        rule: 0,\n        gpios: [],\n        state: false,\n      },\n\n      defaultItem: {\n        name: \"\",\n        rule: 0,\n        gpios: [],\n        state: false,\n      },\n\n      editor: null,\n      editorJSON: \"\",\n    };\n  },\n\n  computed: {\n    formTitle() {\n      return this.editedIndex === -1 ? \"New Automation\" : \"Edit Automation\";\n    },\n    dateRangeText() {\n      return this.dates.join(\" ~ \");\n    },\n  },\n\n  watch: {\n    dialog(val) {\n      val || this.close();\n    },\n    dialogDelete(val) {\n      val || this.closeDelete();\n    },\n  },\n\n  async mounted() {\n    this.initialize();\n  },\n\n  methods: {\n    async createNodeClick() {},\n    handleClick(index) {\n      this.items[index].click.call(this);\n    },\n    clickLogo() {\n      this.$router.push(\"dashboard\");\n    },\n\n    initialize() {\n      this.automations = [\n        {\n          name: \"Automation 1\",\n          state: false,\n          gpios: [],\n          blueprint: {\n            id: \"demo@0.1.0\",\n            nodes: {\n              4: {\n                id: 4,\n                data: {},\n                inputs: {\n                  num1: {\n                    connections: [\n                      {\n                        node: 5,\n                        output: \"num\",\n                        data: {},\n                      },\n                      {\n                        node: 6,\n                        output: \"num\",\n                        data: {},\n                      },\n                    ],\n                  },\n                },\n                outputs: {\n                  num: {\n                    connections: [\n                      {\n                        node: 9,\n                        input: \"num1\",\n                        data: {},\n                      },\n                    ],\n                  },\n                },\n                position: [204.8333740234375, -356.75],\n                name: \"+\",\n              },\n              5: {\n                id: 5,\n                data: {\n                  num1: \"25\",\n                },\n                inputs: {},\n                outputs: {\n                  num: {\n                    connections: [\n                      {\n                        node: 4,\n                        input: \"num1\",\n                        data: {},\n                      },\n                      {\n                        node: 9,\n                        input: \"num2\",\n                        data: {},\n                      },\n                    ],\n                  },\n                },\n                position: [-179.1666259765625, -156.75],\n                name: \"Constant\",\n              },\n              6: {\n                id: 6,\n                data: {\n                  type: \"ALL\",\n                },\n                inputs: {},\n                outputs: {\n                  num: {\n                    connections: [\n                      {\n                        node: 4,\n                        input: \"num1\",\n                        data: {},\n                      },\n                    ],\n                  },\n                },\n                position: [-632.1666259765625, -397.75],\n                name: \"Tempo de permanência\",\n              },\n              9: {\n                id: 9,\n                data: {},\n                inputs: {\n                  num1: {\n                    connections: [\n                      {\n                        node: 4,\n                        output: \"num\",\n                        data: {},\n                      },\n                    ],\n                  },\n                  num2: {\n                    connections: [\n                      {\n                        node: 5,\n                        output: \"num\",\n                        data: {},\n                      },\n                    ],\n                  },\n                },\n                outputs: {\n                  num: {\n                    connections: [\n                      {\n                        node: 10,\n                        input: \"num\",\n                        data: {},\n                      },\n                    ],\n                  },\n                },\n                position: [575.0035706388225, -319.57509650521735],\n                name: \"A>B\",\n              },\n              10: {\n                id: 10,\n                data: {},\n                inputs: {\n                  num: {\n                    connections: [\n                      {\n                        node: 9,\n                        output: \"num\",\n                        data: {},\n                      },\n                    ],\n                  },\n                },\n                outputs: {},\n                position: [951.6885958661557, -262.21828330473755],\n                name: \"End\",\n              },\n            },\n          },\n        },\n      ];\n    },\n\n    async editItem(item) {\n      this.editedIndex = this.automations.indexOf(item);\n      this.editedItem = Object.assign({}, item);\n\n      this.dialog = true;\n\n      setTimeout(async () => {\n        const blueprint = this.editedItem.blueprint;\n        // import blueprint\n        await this.editor.fromJSON(blueprint);\n      }, 200);\n    },\n\n    deleteItem(item) {\n      this.editedIndex = this.automations.indexOf(item);\n      this.editedItem = Object.assign({}, item);\n      this.dialogDelete = true;\n    },\n\n    deleteItemConfirm() {\n      this.automations.splice(this.editedIndex, 1);\n      this.closeDelete();\n    },\n\n    close() {\n      this.dialog = false;\n      this.$nextTick(() => {\n        this.editedItem = Object.assign({}, this.defaultItem);\n        this.editedIndex = -1;\n      });\n    },\n\n    closeDelete() {\n      this.dialogDelete = false;\n      this.$nextTick(() => {\n        this.editedItem = Object.assign({}, this.defaultItem);\n        this.editedIndex = -1;\n      });\n    },\n\n    async save() {\n      const editor = this.editor;\n\n      const blueprint = await editor.toJSON();\n\n      const endNode = this.editor.nodes.find((node) => node.name === \"End\");\n      const endComponent = editor.getComponent(\"End\");\n\n      const logic = endComponent.toJsonLogic?.(endNode);\n\n      const startTime = this.dates;\n      const endTime = this.dates;\n      \n\n      const automation = {\n        name: this.editedItem.name,\n        startTime: startTime.toISOString(),\n        endTime: endTime.toISOString(),\n        enable: this.editedItem.state,\n        gpios: this.editedItem.gpios,\n        rules: logic,\n        blueprint: blueprint,\n      };\n\n      const file = JSON.stringify(automation);\n\n      console.log(file);\n\n      // Enviar POST\n      // OK -> Fechar o dialog, atualizar a tabela\n\n      if (this.editedIndex > -1) {\n        Object.assign(this.automations[this.editedIndex], this.editedItem);\n      } else {\n        this.automations.push(this.editedItem);\n      }\n\n      this.close();\n    },\n\n    async onExport() {\n      const editor = this.editor;\n\n      const endNode = this.editor.nodes.find((node) => node.name === \"End\");\n      const endComponent = editor.getComponent(\"End\");\n\n      console.log(JSON.stringify(endComponent.toJsonLogic?.(endNode)));\n    },\n\n    async onEditorImport() {\n      await this.editor.fromJSON(JSON.parse(this.editorJSON));\n    },\n\n    async onEditorSync() {\n      this.editorJSON = JSON.stringify(await this.editor.toJSON());\n    },\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module"}